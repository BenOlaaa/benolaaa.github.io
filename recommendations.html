<!-- … head and CSS stay exactly the same as in the last version … -->

<script>
  const escapeHtml = (s)=>s.replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));

  const products = [
    {
      category: "Treadmills & Walking Pads",
      items: [
        { title: "Best Budget Friendly Treadmill", href: "https://amzn.to/4mIhqPA", image: "./img/Treadmill%201.jpg", note: "Solid value for incline walking & steady cardio." },
        { title: "Best Budget Friendly Treadmill 2", href: "https://amzn.to/4fAeqlT", image: "./img/Treadmill%202.jpg", note: "Great starter pick with simple setup." },
        { title: "Best Budget Friendly Treadmill 3", href: "https://amzn.to/4lzpwcd", image: "./img/Treadmill%203.jpg", note: "Compact footprint, everyday reliability." },
        { title: "Treadmill Option 2", href: "https://amzn.to/4fzoR9r", image: "./img/Treadmill%204.jpg", note: "Good cushioning and stable frame." },
        { title: "Treadmill Option 3", href: "https://amzn.to/3UYU2kR", image: "./img/Treamill%205.jpg", note: "Smooth belt, easy controls." },
        { title: "Treadmill Option 4", href: "https://amzn.to/4mIhqPA", image: "./img/Treadmill%206.jpg", note: "Budget option with the basics." },
        { title: "Recommended Incline Walking Pad", href: "https://amzn.to/45CUx9i", image: "./img/walking%20pad.jpg", note: "Under-desk friendly with incline (1.5%–8%)." }
      ]
    },
    {
      category: "Shoes",
      items: [
        { title: "Good Recommended Running Shoes", href: "https://amzn.to/4oAnXxi", image: "./img/Nike%20shoe.jpg", note: "Comfortable daily trainer." }
      ]
    },
    {
      category: "Scales",
      items: [
        { title: "Smart Body Scale", href: "https://amzn.to/3JcSG3r", image: "./img/Smart%20Body%20weight%20Scale.jpg", note: "Track weight trends and more (app connected)." },
        { title: "Food Scale", href: "https://amzn.to/45GyjTY", image: "./img/smart%20food%20scale.jpg", note: "Dial in portions and hit protein targets." }
      ]
    },
    {
      category: "Accessories",
      items: [
        { title: "Workout Bench", href: "https://amzn.to/41InFuq", image: "./img/workout%20bench.jpg", note: "Adjustable utility bench for home workouts." },
        { title: "Water Bottle + Tracker", href: "https://amzn.to/47uu0gO", image: "./img/water%20bottle.jpg", note: "Stay hydrated and on schedule." }
      ]
    },
    {
      category: "Supplements",
      items: [
        { title: "Creatine", href: "https://amzn.to/4mnY9Dm", image: "./img/Creatine.jpg", note: "Evidence-based support for strength & performance." },
        { title: "Recommended High-Protein Shake", href: "https://amzn.to/416N7ts", image: "./img/protein%20shake.jpg", note: "Convenient protein for busy days." }
      ]
    },
    {
      category: "Books",
      items: [
        { title: "Spiral Journal Bible", href: "https://amzn.to/4mh01O8", image: "./img/spiral%20bound%20Journaling%20bible.jpg", note: "For notes, reflection, and growth." }
      ]
    }
  ];

  const pillbar = document.getElementById('pillbar');
  const grid = document.getElementById('grid');

  function renderPills(){
    pillbar.innerHTML = "";
    products.forEach((cat,i)=>{
      const b = document.createElement('button');
      b.className = 'pill';
      b.setAttribute('role','tab');
      b.setAttribute('aria-selected', i===0 ? 'true':'false');
      b.textContent = cat.category;
      b.addEventListener('click', ()=>selectTab(i));
      pillbar.appendChild(b);
    });
  }

  function placeholderSvg(){
    return "data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(
      `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 750'>
        <defs><linearGradient id='g' x1='0' x2='1'><stop stop-color='#dcdce0'/><stop offset='1' stop-color='#c8c8ce'/></linearGradient></defs>
        <rect fill='url(#g)' width='1200' height='750'/>
        <text x='50%' y='52%' dominant-baseline='middle' text-anchor='middle' font-family='Helvetica,Arial' font-size='48' fill='#6e6e73'>Product image</text>
      </svg>`
    );
  }

  function cardTemplate(item){
    const img = (item.image && item.image.trim()!=="") ? item.image : placeholderSvg();
    return `
      <article class="card fade-in">
        <div class="media">
          <img alt="${escapeHtml(item.title)}" loading="lazy" src="${img}">
          <div class="badge">Pick</div>
        </div>
        <div class="body">
          <div class="title">${escapeHtml(item.title)}</div>
          ${item.note ? `<div class="desc">${escapeHtml(item.note)}</div>` : ``}
          <div class="actions">
            <a class="btn" href="${item.href}" target="_blank" rel="noopener sponsored nofollow">View on Amazon</a>
            <a class="btn secondary" href="${item.href}" target="_blank" rel="noopener sponsored nofollow" aria-label="Open link in new tab">Open ↗</a>
          </div>
        </div>
      </article>
    `;
  }

  function renderCards(index=0){
    grid.setAttribute('aria-busy','true');
    grid.innerHTML = products[index].items.map(cardTemplate).join('');
    grid.setAttribute('aria-busy','false');
  }

  function selectTab(i){
    [...pillbar.querySelectorAll('.pill')].forEach((p,idx)=>p.setAttribute('aria-selected', idx===i ? 'true':'false'));
    renderCards(i);
  }

  renderPills();
  renderCards(0);
</script>
